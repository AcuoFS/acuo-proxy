'use strict'

const Router = require('restify-router').Router
const routerInstance = new Router()

const _ = require('lodash')

const derivativeJson = require('app/services/derivative')

routerInstance.get('/derivatives', (req, res, next) => {
  let data = _.cloneDeep(derivativeJson.data)

  // filter: type
  if(_.has(req, 'query.type')) {
    data = _(data).filter(obj => obj.type == req.query.type)
  }

  // filter: status
  if(_.has(req, 'query.status')) {
    data = _(data).filter(obj => obj.status == req.query.status)
  }

  // END
  res.json({
    data: data
  })
})

module.exports = (server) => routerInstance.applyRoutes(server)